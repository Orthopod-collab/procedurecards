<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <title>
   Procedure Card Collection Form with AI
  </title>
  <script src="https://cdn.tailwindcss.com">
   function removeLastItem(sectionId) {
  const container = document.getElementById(sectionId);
  const inputs = container.querySelectorAll('input');
  if (inputs.length >= 3) {
    for (let i = 0; i < 3; i++) {
      container.removeChild(container.lastElementChild);
    }
  }
}
  </script>
  <style>
   h4.bg-gray-100 {
    background-color: #d1d5db !important; /* Tailwind's gray-300 */
  }
  </style>
 </head>
 <body class="bg-gray-100 p-6">
  <div class="bg-white rounded shadow p-6 max-w-6xl mx-auto space-y-6">
   <h1 class="text-2xl font-bold text-purple-700">
    Procedure Card Collection Form with AI
   </h1>
   <form class="space-y-6" id="procedureForm">
    <!-- Procedure Name -->
    <div>
     <label class="block font-bold mb-1">
      Procedure Name
     </label>
     <input class="w-full border rounded px-3 py-2" name="procedureName" required="" type="text"/>
    </div>
    <!-- Tags -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
     <div>
      <label class="block font-bold mb-1">
       Anatomy
      </label>
      <select class="w-full border rounded px-3 py-2" name="tags.anatomy">
       <option value="">
        Select Anatomy
       </option>
       <option>
        Shoulder and Elbow
       </option>
       <option>
        Hand and Wrist
       </option>
       <option>
        Spine
       </option>
       <option>
        Pelvis
       </option>
       <option>
        Hips
       </option>
       <option>
        Femur
       </option>
       <option>
        Knee
       </option>
       <option>
        Tibia and Fibula
       </option>
       <option>
        Foot and Ankle
       </option>
      </select>
     </div>
     <div>
      <label class="block font-bold mb-1">
       Supplier
      </label>
      <select class="w-full border rounded px-3 py-2" name="tags.supplier">
       <option value="">
        Select Supplier
       </option>
       <option>
        Acumed
       </option>
       <option>
        Arthrex
       </option>
       <option>
        Arthrocare
       </option>
       <option>
        B Braun
       </option>
       <option>
        Biedermann
       </option>
       <option>
        DePuy Synthes
       </option>
       <option>
        ITS
       </option>
       <option>
        Lavander Medical
       </option>
       <option>
        Leda
       </option>
       <option>
        Lima Enovis
       </option>
       <option>
        Medacta
       </option>
       <option>
        Medtronic
       </option>
       <option>
        Nuvasive
       </option>
       <option>
        Orthofix
       </option>
       <option>
        Paragon
       </option>
       <option>
        Silony Medical
       </option>
       <option>
        Smith and Nephew
       </option>
       <option>
        Stryker
       </option>
       <option>
        Wright Medical
       </option>
       <option>
        Zimmer Biomet
       </option>
      </select>
     </div>
     <div>
      <label class="block font-bold mb-1">
       Preference (Surgeon)
      </label>
      <select class="w-full border rounded px-3 py-2" name="tags.preference">
       <option value="">
        Select Surgeon
       </option>
       <option>
        ACHAN, Pramod
       </option>
       <option>
        AFTAB, Syed
       </option>
       <option>
        AHMED, Hasan
       </option>
       <option>
        AL-HAKIM, Wisam
       </option>
       <option>
        ANG, Sweechai
       </option>
       <option>
        ARESTI, Nick
       </option>
       <option>
        ARSHAD, Homa
       </option>
       <option>
        AYUB, Anouska
       </option>
       <option>
        BALASUBRAMANIAN, Prabu
       </option>
       <option>
        BATES, Peter
       </option>
       <option>
        BHUMBRA, Rej
       </option>
       <option>
        BIJLSMA, Paulien
       </option>
       <option>
        BOTHRA, Sumati
       </option>
       <option>
        BIEDERMANN
       </option>
       <option>
        CARLOS, Adrian
       </option>
       <option>
        CHAMBERLAIN, Mark
       </option>
       <option>
        CULPAN, Paul
       </option>
       <option>
        DAWSON-BOWLING, Sebastian
       </option>
       <option>
        DIMASCIO, Livio
       </option>
       <option>
        EDWARDS, Taff
       </option>
       <option>
        FITZGERALD, Claire
       </option>
       <option>
        GRIFFIN, Xavier
       </option>
       <option>
        HAIDER, Zakir
       </option>
       <option>
        ILIADIS, Alexis-Dimitris
       </option>
       <option>
        JEYASEELAN, Lucky
       </option>
       <option>
        KHAN, Arif
       </option>
       <option>
        LAMBA, Mandeep
       </option>
       <option>
        LEE, Joshua
       </option>
       <option>
        LEE, Paul
       </option>
       <option>
        MAIZEN, Claudia
       </option>
       <option>
        MALAGELADA, Francesc
       </option>
       <option>
        MANOUKIAN, Dimitrios
       </option>
       <option>
        MANGATTIL, Rajesh
       </option>
       <option>
        MILLINGTON, Steven
       </option>
       <option>
        MONTGOMERY, Alexander
       </option>
       <option>
        MUTHUKUMAR, Valliappan
       </option>
       <option>
        NADARAJAH, Ramesh
       </option>
       <option>
        NOORANI, Ali
       </option>
       <option>
        OKAFOR, Ben
       </option>
       <option>
        PATEL, Amit
       </option>
       <option>
        PATEL, Jaison
       </option>
       <option>
        PATEL, Kavi
       </option>
       <option>
        RAMACHANDRAN, Manoj
       </option>
       <option>
        SCOTT, Gareth
       </option>
       <option>
        SEDRA, Fady
       </option>
       <option>
        SMITH
       </option>
       <option>
        SRI-RAM, Kes
       </option>
       <option>
        TSANG, Jerry
       </option>
       <option>
        TSITSKARIS, Konstantinos
       </option>
       <option>
        VAGHELA, Kalpesh
       </option>
       <option>
        VRIS, Alexandros
       </option>
       <option>
        WARD, Jonathan
       </option>
       <option>
        WILLIAMS, Daniel
       </option>
      </select>
     </div>
    </div>
    <!-- Description -->
    <details>
     <summary class="cursor-pointer font-semibold text-purple-700 text-lg">
      Description
     </summary>
     <div class="mt-4 space-y-4">
      <div>
       <label class="block text-sm font-medium">
        Overview
       </label>
       <textarea class="w-full border rounded px-3 py-2" name="description.overview"></textarea>
       <button class="ml-2 bg-purple-600 text-white text-xs px-3 py-1 rounded" onclick="suggestImprovementForField(this, 'overview')" type="button">
        OrthoPod AI suggestion
       </button>
       <div class="text-sm text-green-700 bg-green-50 p-2 rounded border mt-1">
        [Suggestion will appear here]
       </div>
       <button class="ml-2 bg-green-600 text-white text-xs px-2 py-1 rounded" onclick="useAISuggestion(this, 'description.overview')" type="button">
        ⬆ Use Suggestion
       </button>
      </div>
      <div>
       <label class="block text-sm font-medium">
        Steps Outline
       </label>
       <textarea class="w-full border rounded px-3 py-2" name="description.steps"></textarea>
       <button class="ml-2 bg-purple-600 text-white text-xs px-3 py-1 rounded" onclick="suggestImprovementForField(this, 'steps')" type="button">
        OrthoPod AI suggestion
       </button>
       <div class="text-sm text-green-700 bg-green-50 p-2 rounded border mt-1">
        [Suggestion will appear here]
       </div>
       <button class="ml-2 bg-green-600 text-white text-xs px-2 py-1 rounded" onclick="useAISuggestion(this, 'description.steps')" type="button">
        ⬆ Use Suggestion
       </button>
      </div>
     </div>
    </details>
    <details>
     <summary class="text-lg font-semibold text-purple-700">
      Prep &amp; Drape
     </summary>
     <div class="space-y-4 mt-4">
      <div>
       <h4 class="font-medium bg-gray-100 px-3 py-2 rounded">
        Sterile Drape Pack
       </h4>
       <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-2" id="prep-sterileDrapePack">
        <input class="border rounded px-2 py-1" name="prep.sterileDrapePack[0].itemdescription" placeholder="Item Description"/>
        <input class="border rounded px-2 py-1" name="prep.sterileDrapePack[0].ref" placeholder="Product Reference"/>
        <input class="border rounded px-2 py-1" name="prep.sterileDrapePack[0].location" placeholder="Location"/>
       </div>
       <div class="flex gap-4">
        <button class="text-sm text-blue-600" onclick="addItem('prep-sterileDrapePack', 'prep.sterileDrapePack')" type="button">
         Add Item
        </button>
        <button class="text-sm text-red-600" onclick="removeLastItem('prep-sterileDrapePack')" type="button">
         Remove Last
        </button>
       </div>
      </div>
      <div>
       <h4 class="font-medium bg-gray-100 px-3 py-2 rounded">
        Single Drapes
       </h4>
       <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-2" id="prep-singleDrapes">
        <input class="border rounded px-2 py-1" name="prep.singleDrapes[0].itemdescription" placeholder="Item Description"/>
        <input class="border rounded px-2 py-1" name="prep.singleDrapes[0].ref" placeholder="Product Reference"/>
        <input class="border rounded px-2 py-1" name="prep.singleDrapes[0].location" placeholder="Location"/>
       </div>
       <div class="flex gap-4">
        <button class="text-sm text-blue-600" onclick="addItem('prep-singleDrapes', 'prep.singleDrapes')" type="button">
         Add Item
        </button>
        <button class="text-sm text-red-600" onclick="removeLastItem('prep-singleDrapes')" type="button">
         Remove Last
        </button>
       </div>
      </div>
      <div>
       <h4 class="font-medium bg-gray-100 px-3 py-2 rounded">
        Skin Prep
       </h4>
       <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-2" id="prep-skinPrep">
        <input class="border rounded px-2 py-1" name="prep.skinPrep[0].itemdescription" placeholder="Item Description"/>
        <input class="border rounded px-2 py-1" name="prep.skinPrep[0].ref" placeholder="Product Reference"/>
        <input class="border rounded px-2 py-1" name="prep.skinPrep[0].location" placeholder="Location"/>
       </div>
       <div class="flex gap-4">
        <button class="text-sm text-blue-600" onclick="addItem('prep-skinPrep', 'prep.skinPrep')" type="button">
         Add Item
        </button>
        <button class="text-sm text-red-600" onclick="removeLastItem('prep-skinPrep')" type="button">
         Remove Last
        </button>
       </div>
      </div>
      <div>
       <h4 class="font-medium bg-gray-100 px-3 py-2 rounded">
        Application Tools
       </h4>
       <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-2" id="prep-applicationTools">
        <input class="border rounded px-2 py-1" name="prep.applicationTools[0].itemdescription" placeholder="Item Description"/>
        <input class="border rounded px-2 py-1" name="prep.applicationTools[0].ref" placeholder="Product Reference"/>
        <input class="border rounded px-2 py-1" name="prep.applicationTools[0].location" placeholder="Location"/>
       </div>
       <div class="flex gap-4">
        <button class="text-sm text-blue-600" onclick="addItem('prep-applicationTools', 'prep.applicationTools')" type="button">
         Add Item
        </button>
        <button class="text-sm text-red-600" onclick="removeLastItem('prep-applicationTools')" type="button">
         Remove Last
        </button>
       </div>
      </div>
      <div>
       <h4 class="font-medium bg-gray-100 px-3 py-2 rounded">
        Instruction and Steps
       </h4>
       <div class="relative w-full">
        <textarea class="w-full border rounded px-3 py-2 pr-10" name="prep.instructionSteps" placeholder="Instructions"></textarea>
        <button class="absolute right-2 top-2 text-xs text-blue-500 underline" onclick="suggestAI(this)" type="button">
         AI Suggest
        </button>
       </div>
      </div>
      <div>
       <h4 class="font-medium bg-gray-100 px-3 py-2 rounded">
        Demo
       </h4>
       <div class="grid grid-cols-2 gap-4 mb-2">
        <input class="border rounded px-2 py-1" name="prep.demo[0].title" placeholder="Title"/>
        <input class="border rounded px-2 py-1" name="prep.demo[0].url" placeholder="Link (URL)"/>
       </div>
       <button class="text-sm text-blue-600" onclick="addLink('prep-demo', 'prep.demo')" type="button">
        Add Link
       </button>
       <div id="prep-demo">
       </div>
      </div>
     </div>
    </details>
    <details>
     <summary class="text-lg font-semibold text-purple-700">
      Instruments
     </summary>
     <div class="space-y-4 mt-4">
      <div>
       <h4 class="font-medium bg-gray-100 px-3 py-2 rounded">
        Basic Instrument Trays
       </h4>
       <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-2" id="instrument-basicTrays">
        <input class="border rounded px-2 py-1" name="instrument.basicTrays[0].itemdescription" placeholder="Item Description"/>
        <input class="border rounded px-2 py-1" name="instrument.basicTrays[0].ref" placeholder="Product Reference"/>
        <input class="border rounded px-2 py-1" name="instrument.basicTrays[0].location" placeholder="Location"/>
       </div>
       <div class="flex gap-4">
        <button class="text-sm text-blue-600" onclick="addItem('instrument-basicTrays', 'instrument.basicTrays')" type="button">
         Add Item
        </button>
        <button class="text-sm text-red-600" onclick="removeLastItem('instrument-basicTrays')" type="button">
         Remove Last
        </button>
       </div>
      </div>
      <div>
       <h4 class="font-medium bg-gray-100 px-3 py-2 rounded">
        Standby Instrument Trays
       </h4>
       <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-2" id="instrument-standbyTrays">
        <input class="border rounded px-2 py-1" name="instrument.standbyTrays[0].itemdescription" placeholder="Item Description"/>
        <input class="border rounded px-2 py-1" name="instrument.standbyTrays[0].ref" placeholder="Product Reference"/>
        <input class="border rounded px-2 py-1" name="instrument.standbyTrays[0].location" placeholder="Location"/>
       </div>
       <div class="flex gap-4">
        <button class="text-sm text-blue-600" onclick="addItem('instrument-standbyTrays', 'instrument.standbyTrays')" type="button">
         Add Item
        </button>
        <button class="text-sm text-red-600" onclick="removeLastItem('instrument-standbyTrays')" type="button">
         Remove Last
        </button>
       </div>
      </div>
      <div>
  <h4 class="font-medium bg-gray-100 px-3 py-2 rounded">
    Case Specific Instrument Trays
  </h4>
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-2" id="instrument-caseSpecificTrays">
    <input class="border rounded px-2 py-1" name="instrument.caseSpecificTrays[0].itemdescription" placeholder="Item Description"/>
    <input class="border rounded px-2 py-1" name="instrument.caseSpecificTrays[0].ref" placeholder="Product Reference"/>
    <input class="border rounded px-2 py-1" name="instrument.caseSpecificTrays[0].location" placeholder="Location"/>
  </div>
  <div class="flex gap-4">
    <button class="text-sm text-blue-600" onclick="addItem('instrument-caseSpecificTrays', 'instrument.caseSpecificTrays')" type="button">
      Add Item
    </button>
    <button class="text-sm text-red-600" onclick="removeLastItem('instrument-caseSpecificTrays')" type="button">
      Remove Last
    </button>
  </div>
</div>
      <div>
       <h4 class="font-medium bg-gray-100 px-3 py-2 rounded">
        Single Instruments
       </h4>
       <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-2" id="instrument-singleInstruments">
        <input class="border rounded px-2 py-1" name="instrument.singleInstruments[0].itemdescription" placeholder="Item Description"/>
        <input class="border rounded px-2 py-1" name="instrument.singleInstruments[0].ref" placeholder="Product Reference"/>
        <input class="border rounded px-2 py-1" name="instrument.singleInstruments[0].location" placeholder="Location"/>
       </div>
       <div class="flex gap-4">
        <button class="text-sm text-blue-600" onclick="addItem('instrument-singleInstruments', 'instrument.singleInstruments')" type="button">
         Add Item
        </button>
        <button class="text-sm text-red-600" onclick="removeLastItem('instrument-singleInstruments')" type="button">
         Remove Last
        </button>
       </div>
      </div>
     </div>
    </details>
    <details>
     <summary class="text-lg font-semibold text-purple-700">
      Implants
     </summary>
     <div class="space-y-4 mt-4">
      <div>
       <h4 class="font-medium bg-gray-100 px-3 py-2 rounded">
        Implants
       </h4>
       <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-2" id="implants-table">
        <input class="border rounded px-2 py-1" name="implants[0].itemdescription" placeholder="Item Description"/>
        <input class="border rounded px-2 py-1" name="implants[0].ref" placeholder="Product Reference"/>
        <input class="border rounded px-2 py-1" name="implants[0].location" placeholder="Location"/>
       </div>
       <div class="flex gap-4">
        <button class="text-sm text-blue-600" onclick="addItem('implants-table', 'implants')" type="button">
         Add Item
        </button>
        <button class="text-sm text-red-600" onclick="removeLastItem('implants-table')" type="button">
         Remove Last
        </button>
       </div>
      </div>
     </div>
    </details>
    <details>
     <summary class="text-lg font-semibold text-purple-700">
      Consumables
     </summary>
     <div class="space-y-4 mt-4">
      <div>
       <h4 class="font-medium bg-gray-100 px-3 py-2 rounded">
        Wound Closure
       </h4>
       <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-2" id="consumables-woundClosure">
        <input class="border rounded px-2 py-1" name="consumables.woundClosure[0].itemdescription" placeholder="Item Description"/>
        <input class="border rounded px-2 py-1" name="consumables.woundClosure[0].ref" placeholder="Product Reference"/>
        <input class="border rounded px-2 py-1" name="consumables.woundClosure[0].location" placeholder="Location"/>
       </div>
       <div class="flex gap-4">
        <button class="text-sm text-blue-600" onclick="addItem('consumables-woundClosure', 'consumables.woundClosure')" type="button">
         Add Item
        </button>
        <button class="text-sm text-red-600" onclick="removeLastItem('consumables-woundClosure')" type="button">
         Remove Last
        </button>
       </div>
      </div>
      <div>
       <h4 class="font-medium bg-gray-100 px-3 py-2 rounded">
        Dressings
       </h4>
       <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-2" id="consumables-dressings">
        <input class="border rounded px-2 py-1" name="consumables.dressings[0].itemdescription" placeholder="Item Description"/>
        <input class="border rounded px-2 py-1" name="consumables.dressings[0].ref" placeholder="Product Reference"/>
        <input class="border rounded px-2 py-1" name="consumables.dressings[0].location" placeholder="Location"/>
       </div>
       <div class="flex gap-4">
        <button class="text-sm text-blue-600" onclick="addItem('consumables-dressings', 'consumables.dressings')" type="button">
         Add Item
        </button>
        <button class="text-sm text-red-600" onclick="removeLastItem('consumables-dressings')" type="button">
         Remove Last
        </button>
       </div>
      </div>
      <div>
       <h4 class="font-medium bg-gray-100 px-3 py-2 rounded">
        Other Consumables
       </h4>
       <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-2" id="consumables-other">
        <input class="border rounded px-2 py-1" name="consumables.other[0].itemdescription" placeholder="Item Description"/>
        <input class="border rounded px-2 py-1" name="consumables.other[0].ref" placeholder="Product Reference"/>
        <input class="border rounded px-2 py-1" name="consumables.other[0].location" placeholder="Location"/>
       </div>
       <div class="flex gap-4">
        <button class="text-sm text-blue-600" onclick="addItem('consumables-other', 'consumables.other')" type="button">
         Add Item
        </button>
        <button class="text-sm text-red-600" onclick="removeLastItem('consumables-other')" type="button">
         Remove Last
        </button>
       </div>
      </div>
     </div>
    </details>
    <details>
  <summary class="text-lg font-semibold text-purple-700">
    Equipment
  </summary>
  <div class="space-y-4 mt-4">
    <!-- Operating Table Attachments -->
    <div>
      <h4 class="font-medium bg-gray-100 px-3 py-2 rounded">
        Operating Table Attachments
      </h4>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-2" id="equipment-operatingTable">
        <input class="border rounded px-2 py-1" name="equipment.operatingTable[0].itemdescription" placeholder="Item Description"/>
        <input class="border rounded px-2 py-1" name="equipment.operatingTable[0].ref" placeholder="Product Reference"/>
        <input class="border rounded px-2 py-1" name="equipment.operatingTable[0].location" placeholder="Location"/>
      </div>
      <div class="flex gap-4">
        <button class="text-sm text-blue-600" onclick="addItem('equipment-operatingTable', 'equipment.operatingTable')" type="button">
          Add Item
        </button>
        <button class="text-sm text-red-600" onclick="removeLastItem('equipment-operatingTable')" type="button">
          Remove Last
        </button>
      </div>
    </div>

    <!-- Surgical Devices -->
    <div>
      <h4 class="font-medium bg-gray-100 px-3 py-2 rounded">
        Surgical Devices
      </h4>
      <div id="equipment-surgicalDevices" class="space-y-4 mb-2">
        <!-- JS will dynamically insert rows here -->
      </div>
      <button class="text-sm text-blue-600" type="button" onclick="addSurgicalDevice()">
        ＋ Add Surgical Device
      </button>
    </div>

    <!-- Other Equipment -->
    <div>
  <h4 class="font-medium bg-gray-100 px-3 py-2 rounded">
    Other Equipment
  </h4>
  <div id="equipment-otherDevices" class="space-y-4 mb-2">
    <!-- Dynamic rows will be added here -->
  </div>
  <button class="text-sm text-blue-600" type="button" onclick="addOtherEquipmentDevice()">
    ＋ Add Other Equipment
  </button>
</div>

<script>
let otherDeviceIndex = 0;

function addOtherEquipmentDevice() {
  const container = document.getElementById('equipment-otherDevices');
  const wrapper = document.createElement('div');
  wrapper.className = 'space-y-2 border rounded p-3 bg-gray-50';

  const index = otherDeviceIndex;
  const supplierSelectId = `supplier-select-${index}`;
  const otherInputId = `supplier-other-${index}`;

  wrapper.innerHTML = `
    <input class="w-full border rounded px-2 py-1" name="equipment.otherDevices[${index}].itemdescription" placeholder="Item Description" />

    <select class="w-full border rounded px-2 py-1" name="equipment.otherDevices[${index}].supplier" id="${supplierSelectId}" onchange="toggleOtherSupplierField('${supplierSelectId}', '${otherInputId}')">
      <option value="">Select Supplier</option>
      <option>Acumed</option>
      <option>Arthrex</option>
      <option>Arthrocare</option>
      <option>B Braun</option>
      <option>Biedermann</option>
      <option>DePuy Synthes</option>
      <option>ITS</option>
      <option>Lavander Medical</option>
      <option>Leda</option>
      <option>Lima Enovis</option>
      <option>Medacta</option>
      <option>Medtronic</option>
      <option>Nuvasive</option>
      <option>Orthofix</option>
      <option>Paragon</option>
      <option>Silony Medical</option>
      <option>Smith and Nephew</option>
      <option>Stryker</option>
      <option>Wright Medical</option>
      <option>Zimmer Biomet</option>
      <option value="Other">Other</option>
    </select>

    <input style="display: none;" class="w-full border rounded px-2 py-1" id="${otherInputId}" name="equipment.otherDevices[${index}].supplierOther" placeholder="Enter new supplier name" />

    <textarea class="w-full border rounded px-2 py-1" rows="4" name="equipment.otherDevices[${index}].instruction" placeholder="Instruction for Use"></textarea>

    <button type="button" class="text-sm text-red-600" onclick="this.parentElement.remove()">✖ Remove</button>
  `;

  container.appendChild(wrapper);
  otherDeviceIndex++;
}

function toggleOtherSupplierField(selectId, inputId) {
  const select = document.getElementById(selectId);
  const input = document.getElementById(inputId);
  if (select && input) {
    input.style.display = select.value === "Other" ? "block" : "none";
  }
}
</script>


<script>
let surgicalDeviceIndex = 0;
const supplierOptions = `
  <option value=\"\">Select Supplier</option>
  <option>Acumed</option>
  <option>Arthrex</option>
  <option>Arthrocare</option>
  <option>B Braun</option>
  <option>Biedermann</option>
  <option>DePuy Synthes</option>
  <option>ITS</option>
  <option>Lavander Medical</option>
  <option>Leda</option>
  <option>Lima Enovis</option>
  <option>Medacta</option>
  <option>Medtronic</option>
  <option>Nuvasive</option>
  <option>Orthofix</option>
  <option>Paragon</option>
  <option>Silony Medical</option>
  <option>Smith and Nephew</option>
  <option>Stryker</option>
  <option>Wright Medical</option>
  <option>Zimmer Biomet</option>
`;

function addSurgicalDevice() {
  const container = document.getElementById('equipment-surgicalDevices');
  const wrapper = document.createElement('div');
  wrapper.className = 'space-y-2 border rounded p-3 bg-gray-50';
  wrapper.innerHTML = `
    <input class="w-full border rounded px-2 py-1" name="equipment.surgicalDevices[${surgicalDeviceIndex}].itemdescription" placeholder="Item Description" />
    <select class="w-full border rounded px-2 py-1" name="equipment.surgicalDevices[${surgicalDeviceIndex}].supplier">
      ${supplierOptions}
    </select>
    <textarea class="w-full border rounded px-2 py-1" rows="4" name="equipment.surgicalDevices[${surgicalDeviceIndex}].instruction" placeholder="Instruction for Use"></textarea>
    <button type="button" class="text-sm text-red-600" onclick="this.parentElement.remove()">✖ Remove</button>
  `;
  container.appendChild(wrapper);
  surgicalDeviceIndex++;
}
</script>
    </details>

    <details>
     <summary class="text-lg font-semibold text-purple-700">
      Positioning
     </summary>
     <div class="space-y-4 mt-4">
      <div>
       <h4 class="font-medium bg-gray-100 px-3 py-2 rounded">
        Standard Positions
       </h4>
       <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-2" id="positioning-standardPositions">
        <input class="border rounded px-2 py-1" name="positioning.standardPositions[0].itemdescription" placeholder="Item Description"/>
        <input class="border rounded px-2 py-1" name="positioning.standardPositions[0].ref" placeholder="Product Reference"/>
        <input class="border rounded px-2 py-1" name="positioning.standardPositions[0].location" placeholder="Location"/>
       </div>
       <div class="flex gap-4">
        <button class="text-sm text-blue-600" onclick="addItem('positioning-standardPositions', 'positioning.standardPositions')" type="button">
         Add Item
        </button>
        <button class="text-sm text-red-600" onclick="removeLastItem('positioning-standardPositions')" type="button">
         Remove Last
        </button>
       </div>
      </div>
      <div>
       <h4 class="font-medium bg-gray-100 px-3 py-2 rounded">
        Aids &amp; Supports
       </h4>
       <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-2" id="positioning-aidsSupports">
        <input class="border rounded px-2 py-1" name="positioning.aidsSupports[0].itemdescription" placeholder="Item Description"/>
        <input class="border rounded px-2 py-1" name="positioning.aidsSupports[0].ref" placeholder="Product Reference"/>
        <input class="border rounded px-2 py-1" name="positioning.aidsSupports[0].location" placeholder="Location"/>
       </div>
       <div class="flex gap-4">
        <button class="text-sm text-blue-600" onclick="addItem('positioning-aidsSupports', 'positioning.aidsSupports')" type="button">
         Add Item
        </button>
        <button class="text-sm text-red-600" onclick="removeLastItem('positioning-aidsSupports')" type="button">
         Remove Last
        </button>
       </div>
      </div>
     </div>
    </details>
    <details>
     <summary class="cursor-pointer font-semibold text-purple-700 text-lg">
      Training
     </summary>
     <div class="mt-4 space-y-4">
      <div>
       <label class="block text-sm font-medium">
        Operative Technique Links
       </label>
       <div id="trainingLinks">
       </div>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
       <div>
        <label class="block text-sm font-medium">
         Rep Name
        </label>
        <input class="w-full border rounded px-2 py-1" name="training.repName"/>
       </div>
       <div>
        <label class="block text-sm font-medium">
         Email
        </label>
        <input class="w-full border rounded px-2 py-1" name="training.repEmail" type="email"/>
       </div>
       <div>
        <label class="block text-sm font-medium">
         Phone
        </label>
        <input class="w-full border rounded px-2 py-1" name="training.repPhone" type="tel"/>
       </div>
      </div>
     </div>
    </details>
    <!-- AI-Enhanced Cheat Sheet Section -->
    <details>
     <summary class="cursor-pointer font-semibold text-purple-700 text-lg">
      Cheat Sheet
     </summary>
     <div class="mt-4" id="cheatSheetEntries">
     </div>
     <button class="bg-blue-600 text-white text-sm px-4 py-2 mt-2 rounded" onclick="addCheatSheetRow()" type="button">
      ＋ Add Cheat Sheet Entry
     </button>
    </details>
    <button class="bg-green-600 text-white text-sm px-6 py-2 rounded" type="submit">
     Save Procedure Card
    </button>
   </form>
  </div>
  <script>
   const firebaseFunctionURL = "https://<YOUR_REGION>-<YOUR_PROJECT>.cloudfunctions.net/grammarSuggest"; // Replace with your real URL
function createDynamicTable(containerId, label, namePrefix) {
  const container = document.getElementById(containerId);
  container.innerHTML = `
    <label class="block text-sm font-medium mb-1">${label}</label>
    <table class="w-full border text-sm mb-2">
      <thead>
        <tr class="bg-gray-100">
          <th class="border px-2 py-1">Item Description</th>
          <th class="border px-2 py-1">Reference</th>
          <th class="border px-2 py-1">Location</th>
          <th class="border px-2 py-1">Remove</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <button type="button" class="bg-blue-600 text-white text-xs px-3 py-1 rounded" onclick="addRow('${containerId}', '${namePrefix}')">＋ Add Row</button>
  `;
  addRow(containerId, namePrefix);
}
function addRow(containerId, namePrefix) {
  const tbody = document.querySelector(`#${containerId} tbody`);
  const index = tbody.children.length;
  const row = document.createElement('tr');
  row.innerHTML = `
    <td class="border px-2 py-1"><input name="${namePrefix}[${index}][itemdescription]" class="w-full border px-1" /></td>
    <td class="border px-2 py-1"><input name="${namePrefix}[${index}][ref]" class="w-full border px-1" /></td>
    <td class="border px-2 py-1"><input name="${namePrefix}[${index}][location]" class="w-full border px-1" /></td>
    <td class="border px-2 py-1 text-center">
      <button type="button" class="text-purple-600 hover:text-purple-800" onclick="this.closest('tr').remove()">✖</button>
    </td>
  `;
  tbody.appendChild(row);
}
function createLinkEntry(containerId) {
  const container = document.getElementById(containerId);
  const index = container.children.length;
  const div = document.createElement("div");
  div.className = "flex items-center gap-2 mb-2";
  div.innerHTML = `
    <input name="training.links[${index}][title]" class="flex-1 border rounded px-2 py-1" placeholder="Title" />
    <input name="training.links[${index}][url]" class="flex-1 border rounded px-2 py-1" placeholder="URL" />
    <button type="button" class="text-red-500" onclick="this.parentElement.remove()">✖</button>
  `;
  container.appendChild(div);
}
let cheatSheetIndex = 0;
function addCheatSheetRow() {
  const container = document.getElementById("cheatSheetEntries");
  const row = document.createElement("div");
  row.className = "border p-4 rounded bg-gray-50 space-y-2 mt-4";
  row.innerHTML = `
    <div>
      <label class="block text-sm font-medium">Note</label>
      <textarea name="cheatSheet[${cheatSheetIndex}][note]" class="w-full border rounded px-2 py-1" rows="3" placeholder="Write your procedural note or tip..."></textarea>
    </div>
    <div class="flex justify-between items-center gap-2">
      <button type="button" onclick="suggestImprovement(this)" class="bg-purple-600 text-white px-3 py-1 text-sm rounded">OrthoPod AI</button>
      </div>
    <div class="mt-2">
      <div class="text-sm text-green-700 bg-green-50 p-2 rounded border mt-1">[Suggestion will appear here]</div>
    </div>
  `;
  container.appendChild(row);
  cheatSheetIndex++;
}
async function suggestImprovement(button) {
  const wrapper = button.closest("div").parentElement;
  const textarea = wrapper.querySelector("textarea");
  const output = wrapper.querySelector("div.mt-2 div");
  const input = textarea.value.trim();
  if (!input) {
    output.innerText = "Please enter a note for AI to review.";
    return;
  }
  output.innerText = "Processing...";
  try {
    const response = await fetch(firebaseFunctionURL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ note: input })
    });
    const data = await response.json();
    output.innerText = data.suggestion || "No suggestion returned.";
  } catch (error) {
    console.error("AI Error:", error);
    output.innerText = "Failed to generate suggestion.";
  }
}
window.onload = function () {
  createDynamicTable('prepDrapeTable', 'Prep & Drape Items', 'prep');
  createDynamicTable('instrumentTable', 'Instruments', 'instrument');
  createDynamicTable('positioningAids', 'Aids & Supports', 'aids');
  createDynamicTable('implantsTable', 'Implants', 'implants');
  createDynamicTable('consumablesTable', 'Consumables', 'consumables');
  createDynamicTable('equipmentTable', 'Equipment', 'equipment');
  createLinkEntry('trainingLinks');
  addCheatSheetRow();
}
  </script>
  <!-- Firebase Firestore + Storage Integration -->
  <script type="module">
   import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
  import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";
  const firebaseConfig = {
    apiKey: "AIzaSyBclxbJKfToHPiKjR361LmonbBNSx_wGZ0",
    authDomain: "procedure-cards-246a4.firebaseapp.com",
    projectId: "procedure-cards-246a4",
    storageBucket: "procedure-cards-246a4.appspot.com",
    messagingSenderId: "98133126950",
    appId: "1:98133126950:web:a77d390b85eaba55af9be7",
    measurementId: "G-6FNS3R6XDV"
  };
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const storage = getStorage(app);
  async function uploadFile(file, path) {
    if (!file || file.size === 0) return null;
    const storageRef = ref(storage, path);
    await uploadBytes(storageRef, file);
    return await getDownloadURL(storageRef);
  }
  async function getFormDataWithUploads(form) {
    const formData = new FormData(form);
    const data = {};
    const uploads = [];
    for (const [key, value] of formData.entries()) {
      const path = key.replace(/\[(\w+)\]/g, '.$1').split('.');
      let current = data;
      while (path.length > 1) {
        const segment = path.shift();
        if (!current[segment]) current[segment] = {};
        current = current[segment];
      }
      if (value instanceof File && value.name) {
        const safeName = value.name.replace(/[^a-zA-Z0-9_.-]/g, "_");
        const timestamp = Date.now();
        const storagePath = `procedureImages/${timestamp}_${safeName}`;
        uploads.push(uploadFile(value, storagePath).then(url => {
          current[path[0]] = url;
        }));
      } else if (!(value instanceof File)) {
        current[path[0]] = value;
      }
    }
    await Promise.all(uploads);
    return data;
  }
  document.getElementById("procedureForm").addEventListener("submit", async function (e) {
    e.preventDefault();
    const form = e.target;
    try {
      const data = await getFormDataWithUploads(form);
      await addDoc(collection(db, "procedureCards"), data);
      alert("✅ Procedure Card and files saved to Firestore & Storage!");
      form.reset();
    } catch (error) {
      console.error("❌ Error saving procedure:", error);
      alert("Failed to save procedure.");
    }
  });
  </script>
  <script>
   function addCheatSheetRow() {
  const container = document.getElementById("cheatSheetEntries");
  const row = document.createElement("div");
  row.className = "mb-4 space-y-2";
  const textarea = document.createElement("textarea");
  textarea.className = "w-full border rounded px-3 py-2";
  textarea.placeholder = "Enter prompt or leave blank to use 'Steps Outline'";
  const button = document.createElement("button");
  button.textContent = "Generate with AI";
  button.type = "button";
  button.className = "bg-purple-600 text-white text-xs px-3 py-1 rounded";
  const output = document.createElement("div");
  output.className = "text-sm text-gray-700 mt-1";
  button.onclick = async () => {
    const prompt = textarea.value || document.querySelector('[name="description.steps"]').value || "Orthopaedic procedure steps";
    output.textContent = "Loading...";
    try {
      const response = await fetch("https://api.openai.com/v1/chat/completions", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": "Bearer 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"
        },
        body: JSON.stringify({
          model: "gpt-4",
          messages: [{ role: "user", content: prompt }],
          max_tokens: 300
        })
      });
      const data = await response.json();
      output.textContent = data.choices?.[0]?.message?.content || "No response.";
    } catch (err) {
      output.textContent = "Error: " + err.message;
    }
  };
  row.appendChild(textarea);
  row.appendChild(button);
  row.appendChild(output);
  container.appendChild(row);
}
  </script>
  <script>
   function addCheatSheetRow() {
  const container = document.getElementById("cheatSheetEntries");
  const row = document.createElement("div");
  row.className = "mb-4 space-y-2";
  const textarea = document.createElement("textarea");
  textarea.className = "w-full border rounded px-3 py-2";
  textarea.placeholder = "Enter prompt or leave blank to use 'Steps Outline'";
  const button = document.createElement("button");
  button.textContent = "Generate with AI";
  button.type = "button";
  button.className = "bg-purple-600 text-white text-xs px-3 py-1 rounded";
  const output = document.createElement("div");
  output.className = "text-sm text-gray-700 mt-1";
  button.onclick = async () => {
    const prompt = textarea.value || document.querySelector('[name="description.steps"]').value || "Orthopaedic procedure steps";
    output.textContent = "Loading...";
    try {
      const response = await fetch("https://api.openai.com/v1/chat/completions", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": "Bearer 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"
        },
        body: JSON.stringify({
          model: "gpt-4o",
          messages: [{ role: "user", content: prompt }],
          max_tokens: 300
        })
      });
      const data = await response.json();
      if (response.ok && data.choices?.[0]?.message?.content) {
        output.textContent = data.choices[0].message.content;
        console.log("AI Response:", data.choices[0].message.content);
      } else {
        console.error("AI Error:", data);
        output.textContent = "Error: " + (data.error?.message || "No response from AI.");
      }
    } catch (err) {
      console.error("Fetch error:", err);
      output.textContent = "Fetch error: " + err.message;
    }
  };
  row.appendChild(textarea);
  row.appendChild(button);
  row.appendChild(output);
  container.appendChild(row);
}
  </script>
  <script>
   function addCheatSheetRow() {
  const container = document.getElementById("cheatSheetEntries");
  const row = document.createElement("div");
  row.className = "mb-4 space-y-2";
  const textarea = document.createElement("textarea");
  textarea.className = "w-full border rounded px-3 py-2";
  textarea.placeholder = "Enter prompt or leave blank to use 'Steps Outline'";
  const button = document.createElement("button");
  button.textContent = "Generate with OrthoPod AI";
  button.type = "button";
  button.className = "bg-yellow-600 text-white text-xs px-3 py-1 rounded";
  const output = document.createElement("div");
  output.className = "text-sm text-gray-700 mt-1";
  button.onclick = async () => {
    const prompt = textarea.value || document.querySelector('[name="description.steps"]').value || "Orthopaedic procedure steps";
    output.textContent = "Loading...";
    try {
      const response = await fetch("https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=AIzaSyAu7ptOHao6hcKjxFVeHF8I1siVDp0qc38", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          contents: [{ parts: [{ text: prompt }] }]
        })
      });
      const data = await response.json();
      const result = data.candidates?.[0]?.content?.parts?.[0]?.text || "No response.";
      output.textContent = result;
      console.log("Gemini Response:", result);
    } catch (err) {
      console.error("Fetch error:", err);
      output.textContent = "Fetch error: " + err.message;
    }
  };
  row.appendChild(textarea);
  row.appendChild(button);
  row.appendChild(output);
  container.appendChild(row);
}
  </script>
  <script>
   async function suggestImprovementForField(button, field) {
  const textarea = document.querySelector(`[name="description.${field}"]`);
  const output = button.nextElementSibling;
  const input = textarea.value.trim();
  if (!input) {
    output.innerText = "Please enter text for AI to review.";
    return;
  }
  output.innerText = "Processing...";
  try {
    const response = await fetch("https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=AIzaSyAu7ptOHao6hcKjxFVeHF8I1siVDp0qc38", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        contents: [{ parts: [{ text: input }] }]
      })
    });
    const data = await response.json();
    const result = data.candidates?.[0]?.content?.parts?.[0]?.text || "No response.";
    output.innerText = result;
  } catch (error) {
    console.error("AI Error:", error);
    output.innerText = "Failed to generate suggestion.";
  }
}
  </script>
  <script>
   function useAISuggestion(button, fieldName) {
  const suggestionBox = button.previousElementSibling;
  const textarea = document.querySelector(`[name="${fieldName}"]`);
  if (suggestionBox && textarea) {
    textarea.value = suggestionBox.innerText;
    suggestionBox.innerText = "[OrthoPod AI suggestion will appear here]";
  }
}
  </script>
  <script>
   function useAISuggestion(button, fieldName) {
  const suggestionBox = button.previousElementSibling;
  const textarea = document.querySelector(`[name="${fieldName}"]`);
  if (suggestionBox && textarea) {
    textarea.value = suggestionBox.innerText;
    suggestionBox.innerText = "[OrthoPod AI suggestion will appear here]";
  }
}

function addCheatSheetRow() {
  const container = document.getElementById("cheatSheetEntries");
  const row = document.createElement("div");
  row.className = "border p-4 rounded bg-gray-50 space-y-2 mt-4";

  row.innerHTML = `
    <div>
      <label class="block text-sm font-medium">Note</label>
      <textarea name="cheatSheet[${cheatSheetIndex}][note]" class="w-full border rounded px-2 py-1" rows="3" placeholder="Write your procedural note or tip..."></textarea>
    </div>
    <div class="flex justify-start items-center gap-2">
      <button type="button" onclick="suggestCheatSheetImprovement(this)" class="bg-purple-600 text-white px-3 py-1 text-sm rounded">OrthoPod AI suggestion</button>
    </div>
    <div class="mt-2">
      <div class="text-sm text-green-700 bg-green-50 p-2 rounded border mt-1">[Suggestion will appear here]</div>
      <button type="button" class="ml-2 bg-green-600 text-white text-xs px-2 py-1 rounded mt-1" onclick="useCheatSheetSuggestion(this)">⬆ Use Suggestion</button>
    </div>
  `;
  container.appendChild(row);
  cheatSheetIndex++;
}

function suggestCheatSheetImprovement(button) {
  const wrapper = button.closest("div").parentElement;
  const textarea = wrapper.querySelector("textarea");
  const output = wrapper.querySelector("div.mt-2 div");
  const input = textarea.value.trim();
  if (!input) {
    output.innerText = "Please enter a note for AI to review.";
    return;
  }
  output.innerText = "Processing...";
  fetch("https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=AIzaSyAu7ptOHao6hcKjxFVeHF8I1siVDp0qc38", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      contents: [{ parts: [{ text: input }] }]
    })
  })
  .then(res => res.json())
  .then(data => {
    const result = data.candidates?.[0]?.content?.parts?.[0]?.text || "No response.";
    output.innerText = result;
  })
  .catch(err => {
    output.innerText = "Error: " + err.message;
  });
}

function useCheatSheetSuggestion(button) {
  const output = button.previousElementSibling;
  const textarea = button.closest(".border").querySelector("textarea");
  if (output && textarea) {
    textarea.value = output.innerText;
    output.innerText = "[Improved note will appear here]";
  }
}
  </script>
<script>
function addItem(sectionId, namePrefix) {
  const container = document.getElementById(sectionId);
  const index = container.querySelectorAll(`input[name^="${namePrefix}"]`).length / 3;

  const row = document.createElement("div");
  row.className = "grid grid-cols-1 md:grid-cols-3 gap-4 mb-2";
  row.innerHTML = `
    <input class="border rounded px-2 py-1" name="${namePrefix}[${index}].itemdescription" placeholder="Item Description"/>
    <input class="border rounded px-2 py-1" name="${namePrefix}[${index}].ref" placeholder="Product Reference"/>
    <input class="border rounded px-2 py-1" name="${namePrefix}[${index}].location" placeholder="Location"/>
  `;
  container.appendChild(row);
}
</script>

 
<script>
function addItem(sectionId, namePrefix) {
  const container = document.getElementById(sectionId);
  const index = container.querySelectorAll(`input[name^="${namePrefix}"]`).length / 3;

  const item1 = document.createElement("input");
  item1.className = "border rounded px-2 py-1";
  item1.name = `${namePrefix}[${index}].itemdescription`;
  item1.placeholder = "Item Description";

  const item2 = document.createElement("input");
  item2.className = "border rounded px-2 py-1";
  item2.name = `${namePrefix}[${index}].ref`;
  item2.placeholder = "Product Reference";

  const item3 = document.createElement("input");
  item3.className = "border rounded px-2 py-1";
  item3.name = `${namePrefix}[${index}].location`;
  item3.placeholder = "Location";

  container.appendChild(item1);
  container.appendChild(item2);
  container.appendChild(item3);
}

function removeLastItem(sectionId) {
  const container = document.getElementById(sectionId);
  const inputs = container.querySelectorAll('input');
  if (inputs.length >= 3) {
    for (let i = 0; i < 3; i++) {
      container.removeChild(container.lastElementChild);
    }
  }
}
</script>

</body>
</html>
