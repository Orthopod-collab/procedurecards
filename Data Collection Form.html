
<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Procedure Card Collection Form with AI</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6">
<div class="bg-white rounded shadow p-6 max-w-6xl mx-auto space-y-6">
<h1 class="text-2xl font-bold text-purple-700">Procedure Card Collection Form with AI</h1>
<form class="space-y-6" id="procedureForm">
<!-- Procedure Name -->
<div>
<label class="block font-bold mb-1">Procedure Name</label>
<input class="w-full border rounded px-3 py-2" name="procedureName" required="" type="text"/>
</div>
<!-- Tags -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-4">
<div>
<label class="block font-bold mb-1">Anatomy</label>
<select class="w-full border rounded px-3 py-2" name="tags.anatomy">
<option value="">Select Anatomy</option>
<option>Shoulder and Elbow</option>
<option>Hand and Wrist</option>
<option>Spine</option>
<option>Pelvis</option>
<option>Hips</option>
<option>Femur</option>
<option>Knee</option>
<option>Tibia and Fibula</option>
<option>Foot and Ankle</option>
</select>
</div>
<div>
<label class="block font-bold mb-1">Supplier</label>
<select class="w-full border rounded px-3 py-2" name="tags.supplier">
<option value="">Select Supplier</option>
<option>Acumed</option>
<option>Arthrex</option>
<option>Arthrocare</option>
<option>B Braun</option>
<option>Biedermann</option>
<option>DePuy Synthes</option>
<option>ITS</option>
<option>Lavander Medical</option>
<option>Leda</option>
<option>Lima Enovis</option>
<option>Medacta</option>
<option>Medtronic</option>
<option>Nuvasive</option>
<option>Orthofix</option>
<option>Paragon</option>
<option>Silony Medical</option>
<option>Smith and Nephew</option>
<option>Stryker</option>
<option>Wright Medical</option>
<option>Zimmer Biomet</option>
</select>
</div>
<div>
<label class="block font-bold mb-1">Preference (Surgeon)</label>
<select class="w-full border rounded px-3 py-2" name="tags.preference">
<option value="">Select Surgeon</option>
<option>ACHAN, Pramod</option>
<option>AFTAB, Syed</option>
<option>AHMED, Hasan</option>
<option>AL-HAKIM, Wisam</option>
<option>ANG, Sweechai</option>
<option>ARESTI, Nick</option>
<option>ARSHAD, Homa</option>
<option>AYUB, Anouska</option>
<option>BALASUBRAMANIAN, Prabu</option>
<option>BATES, Peter</option>
<option>BHUMBRA, Rej</option>
<option>BIJLSMA, Paulien</option>
<option>BOTHRA, Sumati</option>
<option>BIEDERMANN</option>
<option>CARLOS, Adrian</option>
<option>CHAMBERLAIN, Mark</option>
<option>CULPAN, Paul</option>
<option>DAWSON-BOWLING, Sebastian</option>
<option>DIMASCIO, Livio</option>
<option>EDWARDS, Taff</option>
<option>FITZGERALD, Claire</option>
<option>GRIFFIN, Xavier</option>
<option>HAIDER, Zakir</option>
<option>ILIADIS, Alexis-Dimitris</option>
<option>JEYASEELAN, Lucky</option>
<option>KHAN, Arif</option>
<option>LAMBA, Mandeep</option>
<option>LEE, Joshua</option>
<option>LEE, Paul</option>
<option>MAIZEN, Claudia</option>
<option>MALAGELADA, Francesc</option>
<option>MANOUKIAN, Dimitrios</option>
<option>MANGATTIL, Rajesh</option>
<option>MILLINGTON, Steven</option>
<option>MONTGOMERY, Alexander</option>
<option>MUTHUKUMAR, Valliappan</option>
<option>NADARAJAH, Ramesh</option>
<option>NOORANI, Ali</option>
<option>OKAFOR, Ben</option>
<option>PATEL, Amit</option>
<option>PATEL, Jaison</option>
<option>PATEL, Kavi</option>
<option>RAMACHANDRAN, Manoj</option>
<option>SCOTT, Gareth</option>
<option>SEDRA, Fady</option>
<option>SMITH</option>
<option>SRI-RAM, Kes</option>
<option>TSANG, Jerry</option>
<option>TSITSKARIS, Konstantinos</option>
<option>VAGHELA, Kalpesh</option>
<option>VRIS, Alexandros</option>
<option>WARD, Jonathan</option>
<option>WILLIAMS, Daniel</option>
</select>
</div>
</div>
<!-- Description -->
<details open="">
<summary class="cursor-pointer font-semibold text-purple-700 text-lg">Description</summary>
<div class="mt-4 space-y-4">
<div>
<label class="block text-sm font-medium">Overview</label>
<textarea class="w-full border rounded px-3 py-2" name="description.overview"></textarea>
<button class="ml-2 bg-purple-600 text-white text-xs px-3 py-1 rounded" onclick="suggestImprovementForField(this, 'overview')" type="button">OrthoPod AI suggestion</button><div class="text-sm text-green-700 bg-green-50 p-2 rounded border mt-1">[Suggestion will appear here]</div><button class="ml-2 bg-green-600 text-white text-xs px-2 py-1 rounded" onclick="useAISuggestion(this, 'description.overview')" type="button">⬆ Use Suggestion</button></div>
<div>
  <label class="block text-sm font-medium">Steps Outline</label>
  <textarea class="w-full border rounded px-3 py-2" name="description.steps"></textarea>
  <button class="ml-2 bg-purple-600 text-white text-xs px-3 py-1 rounded" onclick="suggestImprovementForField(this, 'steps')" type="button">OrthoPod AI suggestion</button>
  <div class="text-sm text-green-700 bg-green-50 p-2 rounded border mt-1">[Suggestion will appear here]</div>
  <button class="ml-2 bg-green-600 text-white text-xs px-2 py-1 rounded" onclick="useAISuggestion(this, 'description.steps')" type="button">⬆ Use Suggestion</button>
</div>
</details>
<!-- Dynamic tables placeholder -->
<details>
<summary class="cursor-pointer font-semibold text-purple-700 text-lg">Prep &amp; Drape</summary>
<div class="mt-4" id="prepDrapeTable"></div>
</details>
<details>
<summary class="cursor-pointer font-semibold text-purple-700 text-lg">Instrument</summary>
<div class="mt-4" id="instrumentTable"></div>
</details>
<details>
<summary class="cursor-pointer font-semibold text-purple-700 text-lg">Positioning</summary>
<div class="mt-4 space-y-4">
<div>
<label class="block text-sm font-medium">Standard Positions</label>
<textarea class="w-full border rounded px-3 py-2" name="positioning.positions"></textarea>
</div>
<div id="positioningAids"></div>
</div>
</details>
<details>
<summary class="cursor-pointer font-semibold text-purple-700 text-lg">Implants</summary>
<div class="mt-4" id="implantsTable"></div>
</details>
<details>
<summary class="cursor-pointer font-semibold text-purple-700 text-lg">Consumables</summary>
<div class="mt-4" id="consumablesTable"></div>
</details>
<details>
<summary class="cursor-pointer font-semibold text-purple-700 text-lg">Equipment</summary>
<div class="mt-4" id="equipmentTable"></div>
</details>
<details open="">
<summary class="cursor-pointer font-semibold text-purple-700 text-lg">Training</summary>
<div class="mt-4 space-y-4">
<div>
<label class="block text-sm font-medium">Operative Technique Links</label>
<div id="trainingLinks"></div>
</div>
<div class="grid grid-cols-1 md:grid-cols-3 gap-4">
<div><label class="block text-sm font-medium">Rep Name</label><input class="w-full border rounded px-2 py-1" name="training.repName"/></div>
<div><label class="block text-sm font-medium">Email</label><input class="w-full border rounded px-2 py-1" name="training.repEmail" type="email"/></div>
<div><label class="block text-sm font-medium">Phone</label><input class="w-full border rounded px-2 py-1" name="training.repPhone" type="tel"/></div>
</div>
</div>
</details>
<!-- AI-Enhanced Cheat Sheet Section -->
<details open="">
<summary class="cursor-pointer font-semibold text-purple-700 text-lg">Cheat Sheet (AI Enhanced)</summary>
<div class="mt-4" id="cheatSheetEntries"></div>
<button class="bg-blue-600 text-white text-sm px-4 py-2 mt-2 rounded" onclick="addCheatSheetRow()" type="button">＋ Add Cheat Sheet Entry</button>
</details>
<button class="bg-green-600 text-white text-sm px-6 py-2 rounded" type="submit">Save Procedure Card</button>
</form>
</div>
<script>
const firebaseFunctionURL = "https://<YOUR_REGION>-<YOUR_PROJECT>.cloudfunctions.net/grammarSuggest"; // Replace with your real URL
function createDynamicTable(containerId, label, namePrefix) {
  const container = document.getElementById(containerId);
  container.innerHTML = `
    <label class="block text-sm font-medium mb-1">${label}</label>
    <table class="w-full border text-sm mb-2">
      <thead>
        <tr class="bg-gray-100">
          <th class="border px-2 py-1">Item Description</th>
          <th class="border px-2 py-1">Reference</th>
          <th class="border px-2 py-1">Location</th>
          <th class="border px-2 py-1">Remove</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <button type="button" class="bg-blue-600 text-white text-xs px-3 py-1 rounded" onclick="addRow('${containerId}', '${namePrefix}')">＋ Add Row</button>
  `;
  addRow(containerId, namePrefix);
}
function addRow(containerId, namePrefix) {
  const tbody = document.querySelector(`#${containerId} tbody`);
  const index = tbody.children.length;
  const row = document.createElement('tr');
  row.innerHTML = `
    <td class="border px-2 py-1"><input name="${namePrefix}[${index}][itemdescription]" class="w-full border px-1" /></td>
    <td class="border px-2 py-1"><input name="${namePrefix}[${index}][ref]" class="w-full border px-1" /></td>
    <td class="border px-2 py-1"><input name="${namePrefix}[${index}][location]" class="w-full border px-1" /></td>
    <td class="border px-2 py-1 text-center">
      <button type="button" class="text-purple-600 hover:text-purple-800" onclick="this.closest('tr').remove()">✖</button>
    </td>
  `;
  tbody.appendChild(row);
}
function createLinkEntry(containerId) {
  const container = document.getElementById(containerId);
  const index = container.children.length;
  const div = document.createElement("div");
  div.className = "flex items-center gap-2 mb-2";
  div.innerHTML = `
    <input name="training.links[${index}][title]" class="flex-1 border rounded px-2 py-1" placeholder="Title" />
    <input name="training.links[${index}][url]" class="flex-1 border rounded px-2 py-1" placeholder="URL" />
    <button type="button" class="text-red-500" onclick="this.parentElement.remove()">✖</button>
  `;
  container.appendChild(div);
}
let cheatSheetIndex = 0;
function addCheatSheetRow() {
  const container = document.getElementById("cheatSheetEntries");
  const row = document.createElement("div");
  row.className = "border p-4 rounded bg-gray-50 space-y-2 mt-4";
  row.innerHTML = `
    <div>
      <label class="block text-sm font-medium">Note</label>
      <textarea name="cheatSheet[${cheatSheetIndex}][note]" class="w-full border rounded px-2 py-1" rows="3" placeholder="Write your procedural note or tip..."></textarea>
    </div>
    <div class="flex justify-between items-center gap-2">
      <button type="button" onclick="suggestImprovement(this)" class="bg-purple-600 text-white px-3 py-1 text-sm rounded">OrthoPod AI</button>
      </div>
    <div class="mt-2">
      <label class="block text-sm font-medium text-gray-600">AI Suggested Improvement:</label>
      <div class="text-sm text-green-700 bg-green-50 p-2 rounded border mt-1">[Suggestion will appear here]</div>
    </div>
  `;
  container.appendChild(row);
  cheatSheetIndex++;
}
async function suggestImprovement(button) {
  const wrapper = button.closest("div").parentElement;
  const textarea = wrapper.querySelector("textarea");
  const output = wrapper.querySelector("div.mt-2 div");
  const input = textarea.value.trim();
  if (!input) {
    output.innerText = "Please enter a note for AI to review.";
    return;
  }
  output.innerText = "Processing...";
  try {
    const response = await fetch(firebaseFunctionURL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ note: input })
    });
    const data = await response.json();
    output.innerText = data.suggestion || "No suggestion returned.";
  } catch (error) {
    console.error("AI Error:", error);
    output.innerText = "Failed to generate suggestion.";
  }
}
window.onload = function () {
  createDynamicTable('prepDrapeTable', 'Prep & Drape Items', 'prep');
  createDynamicTable('instrumentTable', 'Instruments', 'instrument');
  createDynamicTable('positioningAids', 'Aids & Supports', 'aids');
  createDynamicTable('implantsTable', 'Implants', 'implants');
  createDynamicTable('consumablesTable', 'Consumables', 'consumables');
  createDynamicTable('equipmentTable', 'Equipment', 'equipment');
  createLinkEntry('trainingLinks');
  addCheatSheetRow();
}
</script>
<!-- Firebase Firestore + Storage Integration -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
  import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";
  const firebaseConfig = {
    apiKey: "AIzaSyBclxbJKfToHPiKjR361LmonbBNSx_wGZ0",
    authDomain: "procedure-cards-246a4.firebaseapp.com",
    projectId: "procedure-cards-246a4",
    storageBucket: "procedure-cards-246a4.appspot.com",
    messagingSenderId: "98133126950",
    appId: "1:98133126950:web:a77d390b85eaba55af9be7",
    measurementId: "G-6FNS3R6XDV"
  };
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const storage = getStorage(app);
  async function uploadFile(file, path) {
    if (!file || file.size === 0) return null;
    const storageRef = ref(storage, path);
    await uploadBytes(storageRef, file);
    return await getDownloadURL(storageRef);
  }
  async function getFormDataWithUploads(form) {
    const formData = new FormData(form);
    const data = {};
    const uploads = [];
    for (const [key, value] of formData.entries()) {
      const path = key.replace(/\[(\w+)\]/g, '.$1').split('.');
      let current = data;
      while (path.length > 1) {
        const segment = path.shift();
        if (!current[segment]) current[segment] = {};
        current = current[segment];
      }
      if (value instanceof File && value.name) {
        const safeName = value.name.replace(/[^a-zA-Z0-9_.-]/g, "_");
        const timestamp = Date.now();
        const storagePath = `procedureImages/${timestamp}_${safeName}`;
        uploads.push(uploadFile(value, storagePath).then(url => {
          current[path[0]] = url;
        }));
      } else if (!(value instanceof File)) {
        current[path[0]] = value;
      }
    }
    await Promise.all(uploads);
    return data;
  }
  document.getElementById("procedureForm").addEventListener("submit", async function (e) {
    e.preventDefault();
    const form = e.target;
    try {
      const data = await getFormDataWithUploads(form);
      await addDoc(collection(db, "procedureCards"), data);
      alert("✅ Procedure Card and files saved to Firestore & Storage!");
      form.reset();
    } catch (error) {
      console.error("❌ Error saving procedure:", error);
      alert("Failed to save procedure.");
    }
  });
</script>
<script>
function addCheatSheetRow() {
  const container = document.getElementById("cheatSheetEntries");
  const row = document.createElement("div");
  row.className = "mb-4 space-y-2";
  const textarea = document.createElement("textarea");
  textarea.className = "w-full border rounded px-3 py-2";
  textarea.placeholder = "Enter prompt or leave blank to use 'Steps Outline'";
  const button = document.createElement("button");
  button.textContent = "Generate with AI";
  button.type = "button";
  button.className = "bg-purple-600 text-white text-xs px-3 py-1 rounded";
  const output = document.createElement("div");
  output.className = "text-sm text-gray-700 mt-1";
  button.onclick = async () => {
    const prompt = textarea.value || document.querySelector('[name="description.steps"]').value || "Orthopaedic procedure steps";
    output.textContent = "Loading...";
    try {
      const response = await fetch("https://api.openai.com/v1/chat/completions", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": "Bearer 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"
        },
        body: JSON.stringify({
          model: "gpt-4",
          messages: [{ role: "user", content: prompt }],
          max_tokens: 300
        })
      });
      const data = await response.json();
      output.textContent = data.choices?.[0]?.message?.content || "No response.";
    } catch (err) {
      output.textContent = "Error: " + err.message;
    }
  };
  row.appendChild(textarea);
  row.appendChild(button);
  row.appendChild(output);
  container.appendChild(row);
}
</script>
<script>
function addCheatSheetRow() {
  const container = document.getElementById("cheatSheetEntries");
  const row = document.createElement("div");
  row.className = "mb-4 space-y-2";
  const textarea = document.createElement("textarea");
  textarea.className = "w-full border rounded px-3 py-2";
  textarea.placeholder = "Enter prompt or leave blank to use 'Steps Outline'";
  const button = document.createElement("button");
  button.textContent = "Generate with AI";
  button.type = "button";
  button.className = "bg-purple-600 text-white text-xs px-3 py-1 rounded";
  const output = document.createElement("div");
  output.className = "text-sm text-gray-700 mt-1";
  button.onclick = async () => {
    const prompt = textarea.value || document.querySelector('[name="description.steps"]').value || "Orthopaedic procedure steps";
    output.textContent = "Loading...";
    try {
      const response = await fetch("https://api.openai.com/v1/chat/completions", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": "Bearer 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"
        },
        body: JSON.stringify({
          model: "gpt-4o",
          messages: [{ role: "user", content: prompt }],
          max_tokens: 300
        })
      });
      const data = await response.json();
      if (response.ok && data.choices?.[0]?.message?.content) {
        output.textContent = data.choices[0].message.content;
        console.log("AI Response:", data.choices[0].message.content);
      } else {
        console.error("AI Error:", data);
        output.textContent = "Error: " + (data.error?.message || "No response from AI.");
      }
    } catch (err) {
      console.error("Fetch error:", err);
      output.textContent = "Fetch error: " + err.message;
    }
  };
  row.appendChild(textarea);
  row.appendChild(button);
  row.appendChild(output);
  container.appendChild(row);
}
</script>
<script>
function addCheatSheetRow() {
  const container = document.getElementById("cheatSheetEntries");
  const row = document.createElement("div");
  row.className = "mb-4 space-y-2";
  const textarea = document.createElement("textarea");
  textarea.className = "w-full border rounded px-3 py-2";
  textarea.placeholder = "Enter prompt or leave blank to use 'Steps Outline'";
  const button = document.createElement("button");
  button.textContent = "Generate with OrthoPod AI";
  button.type = "button";
  button.className = "bg-yellow-600 text-white text-xs px-3 py-1 rounded";
  const output = document.createElement("div");
  output.className = "text-sm text-gray-700 mt-1";
  button.onclick = async () => {
    const prompt = textarea.value || document.querySelector('[name="description.steps"]').value || "Orthopaedic procedure steps";
    output.textContent = "Loading...";
    try {
      const response = await fetch("https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=AIzaSyAu7ptOHao6hcKjxFVeHF8I1siVDp0qc38", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          contents: [{ parts: [{ text: prompt }] }]
        })
      });
      const data = await response.json();
      const result = data.candidates?.[0]?.content?.parts?.[0]?.text || "No response.";
      output.textContent = result;
      console.log("Gemini Response:", result);
    } catch (err) {
      console.error("Fetch error:", err);
      output.textContent = "Fetch error: " + err.message;
    }
  };
  row.appendChild(textarea);
  row.appendChild(button);
  row.appendChild(output);
  container.appendChild(row);
}
</script>
<script>
async function suggestImprovementForField(button, field) {
  const textarea = document.querySelector(`[name="description.${field}"]`);
  const output = button.nextElementSibling;
  const input = textarea.value.trim();
  if (!input) {
    output.innerText = "Please enter text for AI to review.";
    return;
  }
  output.innerText = "Processing...";
  try {
    const response = await fetch("https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=AIzaSyAu7ptOHao6hcKjxFVeHF8I1siVDp0qc38", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        contents: [{ parts: [{ text: input }] }]
      })
    });
    const data = await response.json();
    const result = data.candidates?.[0]?.content?.parts?.[0]?.text || "No response.";
    output.innerText = result;
  } catch (error) {
    console.error("AI Error:", error);
    output.innerText = "Failed to generate suggestion.";
  }
}
</script><script>
function useAISuggestion(button, fieldName) {
  const suggestionBox = button.previousElementSibling;
  const textarea = document.querySelector(`[name="${fieldName}"]`);
  if (suggestionBox && textarea) {
    textarea.value = suggestionBox.innerText;
    suggestionBox.innerText = "[OrthoPod AI suggestion will appear here]";
  }
}
</script><script>
function useAISuggestion(button, fieldName) {
  const suggestionBox = button.previousElementSibling;
  const textarea = document.querySelector(`[name="${fieldName}"]`);
  if (suggestionBox && textarea) {
    textarea.value = suggestionBox.innerText;
    suggestionBox.innerText = "[OrthoPod AI suggestion will appear here]";
  }
}

function addCheatSheetRow() {
  const container = document.getElementById("cheatSheetEntries");
  const row = document.createElement("div");
  row.className = "border p-4 rounded bg-gray-50 space-y-2 mt-4";

  row.innerHTML = `
    <div>
      <label class="block text-sm font-medium">Note</label>
      <textarea name="cheatSheet[${cheatSheetIndex}][note]" class="w-full border rounded px-2 py-1" rows="3" placeholder="Write your procedural note or tip..."></textarea>
    </div>
    <div class="flex justify-start items-center gap-2">
      <button type="button" onclick="suggestCheatSheetImprovement(this)" class="bg-purple-600 text-white px-3 py-1 text-sm rounded">OrthoPod AI suggestion</button>
    </div>
    <div class="mt-2">
      <label class="block text-sm font-medium text-gray-600">AI Suggested Improvement:</label>
      <div class="text-sm text-green-700 bg-green-50 p-2 rounded border mt-1">[Suggestion will appear here]</div>
      <button type="button" class="ml-2 bg-green-600 text-white text-xs px-2 py-1 rounded mt-1" onclick="useCheatSheetSuggestion(this)">⬆ Use Suggestion</button>
    </div>
  `;
  container.appendChild(row);
  cheatSheetIndex++;
}

function suggestCheatSheetImprovement(button) {
  const wrapper = button.closest("div").parentElement;
  const textarea = wrapper.querySelector("textarea");
  const output = wrapper.querySelector("div.mt-2 div");
  const input = textarea.value.trim();
  if (!input) {
    output.innerText = "Please enter a note for AI to review.";
    return;
  }
  output.innerText = "Processing...";
  fetch("https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=AIzaSyAu7ptOHao6hcKjxFVeHF8I1siVDp0qc38", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      contents: [{ parts: [{ text: input }] }]
    })
  })
  .then(res => res.json())
  .then(data => {
    const result = data.candidates?.[0]?.content?.parts?.[0]?.text || "No response.";
    output.innerText = result;
  })
  .catch(err => {
    output.innerText = "Error: " + err.message;
  });
}

function useCheatSheetSuggestion(button) {
  const output = button.previousElementSibling;
  const textarea = button.closest(".border").querySelector("textarea");
  if (output && textarea) {
    textarea.value = output.innerText;
    output.innerText = "[Improved note will appear here]";
  }
}
</script></body>
</html>
